<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.4//EN"
"http://www.oasis-open.org/docbook/xml/4.4/docbookx.dtd">
<!--
  ~ This file is part of Geomajas, a component framework for building
  ~ rich Internet applications (RIA) with sophisticated capabilities for the
  ~ display, analysis and management of geographic information.
  ~ It is a building block that allows developers to add maps
  ~ and other geographic data capabilities to their web applications.
  ~
  ~ Copyright 2008-2010 Geosparc, http://www.geosparc.com, Belgium
  ~
  ~ This program is free software: you can redistribute it and/or modify
  ~ it under the terms of the GNU Affero General Public License as
  ~ published by the Free Software Foundation, either version 3 of the
  ~ License, or (at your option) any later version.
  ~
  ~ This program is distributed in the hope that it will be useful,
  ~ but WITHOUT ANY WARRANTY; without even the implied warranty of
  ~ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  ~ GNU Affero General Public License for more details.
  ~
  ~ You should have received a copy of the GNU Affero General Public License
  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.
  -->
<chapter id="chapter-configuration">
  <title>Configuration</title>

  <para>To use the GWT face, you have to include the relevant dependencies,
  the required build steps, and make sure the GWT dispatcher servlet is
  included in your web.xml.</para>

  <section>
    <title>Dependencies</title>

    <para>You have to include the GWT face (client) module. As this is a GWT
    specific jar, it already includes the source (in many other cases, you
    would need to explicitly add the sources as well).</para>

    <example>
      <title>Include GWT client dependency</title>

      <programlisting>&lt;dependency&gt;
    &lt;groupId&gt;org.geomajas&lt;/groupId&gt;
    &lt;artifactId&gt;geomajas-gwt-client&lt;/artifactId&gt;
&lt;/dependency&gt;</programlisting>
    </example>

    <para>You also include the GWT dependencies themselves. Even though these
    dependencies are already used by the geomajas-gwt-client module, they need
    to be redefined because of the scopes.</para>

    <example>
      <title>GWT dependencies</title>

      <programlisting>&lt;dependency&gt;
    &lt;groupId&gt;com.google.gwt&lt;/groupId&gt;
    &lt;artifactId&gt;gwt-user&lt;/artifactId&gt;
    &lt;scope&gt;provided&lt;/scope&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;com.google.gwt&lt;/groupId&gt;
    &lt;artifactId&gt;gwt-servlet&lt;/artifactId&gt;
    &lt;scope&gt;runtime&lt;/scope&gt;
&lt;/dependency&gt;</programlisting>
    </example>

    <para>These snippets don't include any version info. It is assumed that
    you use the geomajas-dep module in a recent incarnation to assure these
    versions are set.</para>

    <example>
      <title>Including geomajas-dep for module versions</title>

      <programlisting>&lt;dependencyManagement&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.geomajas&lt;/groupId&gt;
            &lt;artifactId&gt;geomajas-dep&lt;/artifactId&gt;
            &lt;version&gt;1.10.24&lt;/version&gt;
            &lt;type&gt;pom&lt;/type&gt;
            &lt;scope&gt;import&lt;/scope&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
&lt;/dependencyManagement&gt;
</programlisting>
    </example>

    <para>If you want to use a snapshot version of the GWT face, you should
    also included a dependency on the specific snapshot in the
    dependencyManagement section of your pom.</para>

    <example>
      <title>DependencyManagement with geomajas-dep and a snapshot GWT
      face</title>

      <programlisting>&lt;dependencyManagement&gt;
    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.geomajas&lt;/groupId&gt;
            &lt;artifactId&gt;geomajas-face-gwt&lt;/artifactId&gt;
            &lt;version&gt;1.8.0-SNAPSHOT&lt;/version&gt;
            &lt;type&gt;pom&lt;/type&gt;
            &lt;scope&gt;import&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.geomajas&lt;/groupId&gt;
            &lt;artifactId&gt;geomajas-dep&lt;/artifactId&gt;
            &lt;version&gt;1.10.24&lt;/version&gt;
            &lt;type&gt;pom&lt;/type&gt;
            &lt;scope&gt;import&lt;/scope&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
&lt;/dependencyManagement&gt;
</programlisting>
    </example>
  </section>

  <section>
    <title>web.xml</title>

    <para>You need to include the Geomajas GWT service to assure the GWT files
    can be found. The servlet mapping has to be edited to match your module
    class's fully qualified name (example here from the geomajas-gwt-simple
    module).</para>

    <example>
      <title>GWT servlet definition</title>

      <programlisting>&lt;servlet&gt;
    &lt;servlet-name&gt;GeomajasServiceServlet&lt;/servlet-name&gt;
    &lt;servlet-class&gt;org.geomajas.gwt.server.GeomajasServiceImpl&lt;/servlet-class&gt;
&lt;/servlet&gt;

&lt;servlet-mapping&gt;
    &lt;servlet-name&gt;GeomajasServiceServlet&lt;/servlet-name&gt;
    &lt;url-pattern&gt;/mypackage.GeomajasSimple/geomajasService&lt;/url-pattern&gt;
&lt;/servlet-mapping&gt;</programlisting>
    </example>
  </section>

  <section>
    <title>Build steps</title>

    <para>The GWT compilation needs to be added as one of the build steps. You
    will need to update the module class and the i18nConstantsWithLookupBundle
    to match your application.</para>

    <example>
      <title>GWT compilation</title>

      <programlisting>&lt;plugin&gt;
    &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;
    &lt;artifactId&gt;gwt-maven-plugin&lt;/artifactId&gt;
    &lt;version&gt;1.2&lt;/version&gt;
    &lt;configuration&gt;
        &lt;inplace&gt;true&lt;/inplace&gt;
        &lt;module&gt;mypackage.GeomajasSimple&lt;/module&gt;
        &lt;runTarget&gt;index.html&lt;/runTarget&gt;
        &lt;warSourceDirectory&gt;war&lt;/warSourceDirectory&gt;
        &lt;disableCastChecking&gt;true&lt;/disableCastChecking&gt;
        &lt;disableClassMetadata&gt;true&lt;/disableClassMetadata&gt;
        &lt;extraJvmArgs&gt;-Xmx512M -Xss1024k&lt;/extraJvmArgs&gt;
        &lt;i18nConstantsWithLookupBundle&gt;
            mypackage.client.i18n.Simple
        &lt;/i18nConstantsWithLookupBundle&gt;
    &lt;/configuration&gt;
    &lt;executions&gt;
        &lt;execution&gt;
            &lt;id&gt;test&lt;/id&gt;
            &lt;goals&gt;
                &lt;goal&gt;clean&lt;/goal&gt;
                &lt;goal&gt;compile&lt;/goal&gt;
                &lt;goal&gt;generateAsync&lt;/goal&gt;
                &lt;goal&gt;test&lt;/goal&gt;
            &lt;/goals&gt;
        &lt;/execution&gt;
        &lt;execution&gt;
            &lt;id&gt;i18n&lt;/id&gt;
            &lt;phase&gt;generate-resources&lt;/phase&gt;
            &lt;goals&gt;
                &lt;goal&gt;i18n&lt;/goal&gt;
            &lt;/goals&gt;
        &lt;/execution&gt;
    &lt;/executions&gt;
&lt;/plugin&gt;</programlisting>
    </example>
  </section>
</chapter>
