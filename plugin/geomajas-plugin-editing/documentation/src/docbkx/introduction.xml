<?xml version="1.0" encoding="UTF-8"?>
<!--
  ~ This is part of Geomajas, a GIS framework, http://www.geomajas.org/.
  ~
  ~ Copyright 2008-2012 Geosparc nv, http://www.geosparc.com/, Belgium.
  ~
  ~ The program is available in open source according to the GNU Affero
  ~ General Public License. All contributions in this program are covered
  ~ by the Geomajas Contributors License Agreement. For full licensing
  ~ details, see LICENSE.txt in the project root.
  -->
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.4//EN"
"http://www.oasis-open.org/docbook/xml/4.4/docbookx.dtd">
<chapter id="chapter-introduction">
  <title>Introduction</title>

  <para>This plug-in provides a set of services and utilities for visually
  editing geometries on the map within a GWT environment. It uses the Geomajas
  Geometry Project as the base geometry type, and the
  <code>MapController</code> definition from the Geomajas Common GWT face
  library. On top of the visual geometry editing, this plug-in also provides
  services for snapping, splitting and merging.</para>

  <sect1>
    <title>Model-view-controller</title>

    <para>In essence the editing follows the tried and tested
    Model-View-Controller principle:</para>

    <itemizedlist>
      <listitem>
        <para>Model: The central <code>GeometryEditService</code>. It keeps
        track of the location and status of all vertices and edges of the
        geometry being edited.</para>
      </listitem>

      <listitem>
        <para>View: The <code>GeometryEditService</code> will fires events
        that are being picked up by a specific renderer. Any change in the
        shape of the geometry or the status of it's vertices/edges will be
        caught and visually displayed on the map.</para>
      </listitem>

      <listitem>
        <para>Controller: A series of handlers will execute methods in the
        <code>GeometryEditService</code>, based upon user interaction on the
        map.</para>

        <note>
          <para>As the rendering is face specific, the focus has first gone to
          the GWT face. An implementation for the PureGWT face will follow
          later.</para>
        </note>
      </listitem>
    </itemizedlist>

    <para>The renderer is one example of a listener to the many events that
    the <code>GeometryEditService</code> fires, but essentially anyone can
    listen to those events. If you need to react to any change in a geometry's
    shape, just add the correct handler.</para>
  </sect1>

  <sect1>
    <title>The GeometryIndex concept</title>

    <para>Before trying to figure out how the <code>GeometryEditService</code>
    works, it is important to understand the <code>GeometryIndex</code>
    concept. A <code>GeometryIndex</code> is an index within a geometry that
    points to a single vertex, edge or sub-geometry. All operations within the
    <code>GeometryEditService</code> operate on a list such
    <code>GeometryIndices</code>.</para>

    <para>Take for example the "move" operation. This operation will move the
    given <code>GeometryIndex</code> to the specified location. This operation
    is used when the user drags a vertex around on the map, but this operation
    could also be used to let the user drag an interior ring within a polygon,
    or an entire LineString within a MultiLineString, or event the whole
    geometry.</para>
  </sect1>

  <sect1>
    <title>The central services</title>

    <para>There are 3 central services that help in the editing process. All
    three have a very distinct responsibility:</para>

    <itemizedlist>
      <listitem>
        <para><emphasis>GeometryEditService</emphasis>: Defines the editing
        workflow and the basic operations (with undo/redo) that are supported.
        Also allows to add handlers to all events.</para>
      </listitem>

      <listitem>
        <para><emphasis>GeometryIndexService</emphasis>: This service defines
        operations for creating and manipulating GeometryIndices. It also
        supports retrieving information based upon a certain geometry and
        index. For example what are the adjacent vertices to a certain edge
        within a given geometry?</para>
      </listitem>

      <listitem>
        <para><emphasis>GeometryIndexStateService</emphasis>: Keeps track of
        the state of all indices that make up the geometry being edited. It
        allows for selecting/deselecting, enabling/disabling, highlighting,
        etc any vertices/edges/sub-geometries during the editing process. This
        state can then be used by the controllers. For example, a controller
        could allow only selected vertices to be dragged by the user.</para>
      </listitem>
    </itemizedlist>

    <para>There are more services then the 3 mentioned above such as a
    <code>SnapService</code>, <code>GeometryMergeService</code> and
    <code>GeometrySplitService</code>, but those just add more functionality
    to the basic set that the 3 above already provide.</para>
  </sect1>
</chapter>
