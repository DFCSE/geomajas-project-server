<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<!--
		  ~ This is part of Geomajas, a GIS framework, http://www.geomajas.org/.
		  ~
		  ~ Copyright 2008-2011 Geosparc nv, http://www.geosparc.com/, Belgium.
		  ~
		  ~ The program is available in open source according to the GNU Affero
		  ~ General Public License. All contributions in this program are covered
		  ~ by the Geomajas Contributors License Agreement. For full licensing
		  ~ details, see LICENSE.txt in the project root.
		  -->
<head>
	<meta http-equiv="content-type" content="text/html;charset=utf-8" />
	<link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />

	<title>Geomajas Javascript API - JS only test</title>
	<link type="text/css" rel="stylesheet" href="geomajas.css">

	<script type="text/javascript" language="javascript">var isomorphicDir = "emptyApp/sc/";</script>
	<script type="text/javascript" language="javascript" src="emptyApp/emptyApp.nocache.js"></script>
		
	<script type="text/javascript">
		var map;

		function initialize() {
			var d = document.getElementById('log');
			d.innerHTML += "Initializing the map...";
			map = Geomajas().createMap("app", "mapMain", "js-map-element");
			d.innerHTML += "done.<br>";
		}

		function listMethods(myObject) {
			var element = document.getElementById('log');
			element.innerHTML += "Properties for " + myObject;
			for ( var property in myObject) {
				element.innerHTML += "<br>Property: "+ property;
			}
		}
		
		function log(text) {
			var element = document.getElementById('log');
			element.innerHTML += "<br>" + text;
		}
	</script>
	<script type="text/javascript" language="javascript" src="geomajas-api-test.js"></script>
</head>

<body _onLoad="initialize()">
	<div class="titleBar">
		<div class="title">Geomajas JavaScript API test</div>
		<div class="subtitle">This example uses an empty GWT application - JavaScript only</div>
		<button onclick="initialize()">INIT</button>
	</div>
	<div>
		<table CELLSPACING="0" CELLPADDING="5">
			<tr>
				<td style="width:640px;">
					<div id="js-map-element" style="width:640px; height:480px; border: 1px solid #337428;">
						<!-- on load, the map is attached here -->
					</div>
					<div id="log" style="border: 1px solid #337428; margin-top:5px; padding:3px 5px;">
						<h3>Log window:</h3>
					</div>
				</td>
				<td valign="top">
					<h2>Navigation</h2>
					<h4>Translating</h4>
					<button onclick="translate(-1, 0)">LEFT</button>
					<button onclick="translate(1, 0)">RIGHT</button>
					<button onclick="translate(0, -1)">DOWN</button>
					<button onclick="translate(0, 1)">UP</button>
					Move distance: <input type="text" id="translateDistance" value="100000" /> <i>(Map units, meters)</i>

					<h4>Scaling (a.k.a zooming)</h4>
					<button onclick="zoomIn()">Zoom in</button>
					<button onclick="zoomOut()">Zoom out</button>
					Factor: <input type="text" id="zoomFactor" value="2" />

					<h4>By bounds</h4>
					<button onclick="displayBounds()">Get bounds</button>&nbsp;<button onclick="applyBounds()">Apply bounds</button><br />
					Xmin: <input type="text" id="boundsXmin" />
					Xmax: <input type="text" id="boundsXmax" /><br/>
					Ymin: <input type="text" id="boundsYmin" />
					Ymax: <input type="text" id="boundsYmax" />
					
					<h2>Map & Layers</h2>
					<h4>Layers</h4>
					<button onclick="getLayers()">Get layers</button>
					<textarea rows="5" cols="50" id="layersList"></textarea>

					<h4>Visibility second layer</h4>
					<button onclick="toggleVisibility()">Toggle visibility</button>
				</td>
			</tr>
		</table>
	</div>
</body>


<!-- 
<body>
<h2>Embedded map initialized from GWT entrypoint</h2>
<div id="map" style="width: 600px; height: 450px; float: right; border: 1px solid black; margin: 5px; "></div>

					
						<h5>Selection</h5>
						<button onclick="getSelectedFeatures()">Get selected features</button>
						<textarea rows="5" cols="50" id="selectedFeatures"></textarea>
	<script type="text/javascript">
		function getSelectedFeatures() {
			var map = getMap();
			var features = map.getLayersModel().getSelectedFeatures();
			var featuresString = "";
			
			for (var i = 0; i < features.length; i++) {
				featuresString += features[i] + "\n";
			}
			
			document.getElementById("selectedFeatures").value = featuresString;
		}
		
	</script>				


						<h5>Features</h5>
						<div style="float: left;">
							Layer id: <input type="text" id="getFeatureLayerId"
								value="clientLayerCountries" /><br />
							<button onclick="retrieveFeaturesOnMap()">Get features
								visible on map</button>
							<br />
							<button onclick="retrieveAllFeatures()">Get all features</button>
							<br />
							<button onclick="retrieveFeature()">Get feature by id</button><br/>
							Feature id: <input type="text" id="getFeatureId"
								value="110m_admin_0_countries.56" /><br />
						</div>
						<div>
							<textarea rows="8" cols="50" id="getFeatureFeature"></textarea>
						</div>

		<script type="text/javascript">
		
		function printFeatureInfo(feature) {
			var featureInfo = feature.getLabel() + "\n";
			featureInfo += feature.getBounds() + "\n";
			
			var attr = feature.getAttributes();
			for (var i = 0; i < attr.length; i++) {
				featureInfo += attr[i] + ": " + feature.getAttributeValue(attr[i]) + "\n";
			}
			return featureInfo;
		}
		
		function retrieveFeature() {
			var map = getMap();
			var featureId = document.getElementById("getFeatureId").value;
			var layerId = document.getElementById("getFeatureLayerId").value;
			
			var layer = map.getLayersModel().getVectorLayer(layerId);
			
			layer.getFeature(featureId, function (feature) {
				
				if (feature != null) {
					document.getElementById("getFeatureFeature").value = printFeatureInfo(feature);
				} else {
					document.getElementById("getFeatureFeature").value = "no feature found";
				}
			});			
			
		}

		function retrieveAllFeatures() {
			var map = getMap();
			var layerId = document.getElementById("getFeatureLayerId").value;
			var layer = map.getLayersModel().getVectorLayer(layerId);
			layer.getFeatures(map.getViewPort().getMaximumBounds(), function (features) {
				var featuresInfo = "";
				for(var i = 0; i < features.length; i++) {
					featuresInfo += features[i] + "\n";
				}
				document.getElementById("getFeatureFeature").value = featuresInfo;
			});
		}
		
		function retrieveFeaturesOnMap() {
			var map = getMap();
			var layerId = document.getElementById("getFeatureLayerId").value;
			var layer = map.getLayersModel().getVectorLayer(layerId);
			layer.getFeatures(map.getViewPort().getBounds(), function (features) {
				var featuresInfo = "";
				for(var i = 0; i < features.length; i++) {
					featuresInfo += features[i] + "\n";
				}
				document.getElementById("getFeatureFeature").value = featuresInfo;
			});
		}
	</script>				


					<h3>java code (org.geomajas.plugin.jsapi.example.client.Application)</h3>
					<p>Make sure you call setHtmlElement and set the size before drawing the map. It's also important 
					that you use org.geomajas.plugin.jsapi.client.exporter.map.Map, this is a facade for the 
					geomajas MapWidget that is available from pure javascript.</p>
					<code>
						<pre>
public void onModuleLoad() {
	...
	final MapWidget mapWidget = new MapWidget("mainMap", "app");
	//Initialize the javascript Map
	Map jsMap = new Map(mapWidget);
	mapWidget.setHtmlElement(DOM.getElementById("map"));
	mapWidget.setWidth(DOM.getElementById("map").getStyle().getWidth());
	mapWidget.setHeight(DOM.getElementById("map").getStyle().getHeight());
	mapWidget.draw();
	...
}
				</pre>
					</code>

				<h2>Embedded map initialized from javascript callback function
					geomajasOnload()</h2>

				<div id="exportermap" style="width: 400px; height: 300px; float: right; border: 1px solid black; margin: 5px; "></div></td>

				<p>
					The <a href="http://code.google.com/p/gwt-exporter/">GWT-exporter</a>
					library allows to export GWT classes as javascript prototypes. The
					following map is created in pure javascript, using an API similar
					to Google maps or OpenLayers. See
					org.geomajas.test.client.exporter.MarkerMap for the API definition
					and org.geomajas.test.Application for setting up the
					geomajasOnLoad() function.
				</p>

					<h3>javascript code (see page source)</h3>
					<code>
						<pre>
function geomajasOnLoad() {
	var map = new org.geomajas.MarkerMap("exporterMap", "app");
	map.setHtmlElementId("exportermap");
	map.setWidth("400px");
	map.setHeight("300px");
	map.draw();
	map.addOnLoad(function() {
		map.setCenter(51.05, 3.716667);
		map.setZoomLevel(10);
		map.addMarker("some marker", 51, 3.7, "images/marker.png", 34, 34);
	});
}
				</pre>
					</code>


	<script type="text/javascript" language="javascript">

		function geomajasOnLoad() {
			var registry = new org.geomajas.jsapi.WidgetRegistryFactory();
			var mapWidgetRegistry = registry.getMapWidgetRegistry();

			var map = mapWidgetRegistry.getMapWidget("mainMap", "app");

			alert(map);
		}

		/*
		 var map = new org.geomajas.MarkerMap("exporterMap", "app");
		 map.setHtmlElementId("exportermap");
		 map.setWidth("400px");
		 map.setHeight("300px");
		 map.draw();
		 map.addOnLoad(function() {
		 map.setCenter(51.05, 3.716667);
		 map.setZoomLevel(10);
		 map.addMarker("some marker", 51, 3.7, "images/marker.png", 34, 34);
		 });
		 //		var tralalala = map.getMapWidget();
		 //		var obj = eval(tralalala);

		 map.addOnLoad(function() {
		 map.setCenter(51.05, 3.716667);
		 map.setZoomLevel(10);
		 map.addMarker("some marker", 51, 3.7, "images/marker.png", 34, 34);
		 });
		 /*
		 */
	</script>


	<iframe src="javascript:''" id="__gwt_historyFrame" tabIndex='-1'
		style="position: absolute; width: 0; height: 0; border: 0"></iframe>
</body>
 -->
</html>
