<html>
<!--
		  ~ This is part of Geomajas, a GIS framework, http://www.geomajas.org/.
		  ~
		  ~ Copyright 2008-2011 Geosparc nv, http://www.geosparc.com/, Belgium.
		  ~
		  ~ The program is available in open source according to the GNU Affero
		  ~ General Public License. All contributions in this program are covered
		  ~ by the Geomajas Contributors License Agreement. For full licensing
		  ~ details, see LICENSE.txt in the project root.
		  -->
<head>
	<meta http-equiv="content-type" content="text/html;charset=utf-8" />
	<link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon" />
	
	<title>Geomajas Javascript API - JS only test</title>
	<link type="text/css" rel="stylesheet" href="geomajas.css" />
	
	<script type="text/javascript" language="javascript">var isomorphicDir = "emptyApp/sc/";</script>
	<script type="text/javascript" language="javascript" src="emptyApp/emptyApp.nocache.js"></script>
	
	<script type="text/javascript">
		var map;

		function onGeomajasLoad() {
			var d = document.getElementById('log');
			d.innerHTML += "Initializing the map...";
			map = Geomajas().createMap("app", "mapMain", "js-map-element");
			d.innerHTML += "done.<br>";
		}

		function getController() {
			var mapController = map.getMapController();
			log(mapController);
		}

		function applyCustomController() {
			var mapController = new org.geomajas.jsapi.controller.MapController(map);
			mapController.setMouseMoveHandler(function(event) {
				var screenLocation = mapController.getLocation(event, "screen");
				var worldLocation = mapController.getLocation(event, "world");
				displayMouseLocation(screenLocation, worldLocation);
			});
			mapController.setMouseOverHandler(function(event) {
				log("Mouse Over");
			});
			mapController.setMouseOutHandler(function(event) {
				log("Mouse Out");
			});
			mapController.setDownHandler(function(event) {
				log("Down" + mapController.getLocation(event, "screen"));
			});
			mapController.setUpHandler(function(event) {
				log("Up");
			});
 			mapController.setActivationHandler(function(){
				var element = document.getElementById("mouse-location");
				element.innerHTML = "Activated custom controller...";
			});
			mapController.setDeactivationHandler(function(){
				var element = document.getElementById("mouse-location");
				element.innerHTML = "Deactivated custom controller...";
			});

			map.setMapController(mapController);
		}

		function applyMapController(id) {
			var mapController = Geomajas().createMapController(map, id);
			map.setMapController(mapController);
		}

		function displayMouseLocation(screenLocation, worldLocation) {
			var element = document.getElementById("mouse-location");
			var txt = "<b>Mouse location:</b><br>"
			txt += "Screen: " + screenLocation.getX() + ", " + screenLocation.getY();
			txt += "<br>World: " + worldLocation.getX() + ", " + worldLocation.getY();
			element.innerHTML = txt;
		}

		function log(text) {
			var element = document.getElementById('log');
			element.innerHTML += "<br>" + text;
		}
	</script>
	<script type="text/javascript" language="javascript" src="geomajas-api-test.js"></script>
</head>

<body>
	<div class="titleBar">
		<div class="title">Geomajas JavaScript API test</div>
		<div class="subtitle">This example uses an empty GWT application - JavaScript only</div>
	</div>
	<div>
		<table cellspacing="0" cellpadding="5">
			<tr>
				<td style="width: 640px;">
					<div id="js-map-element" style="width: 640px; height: 480px; border: 1px solid #337428;">
						<!-- on load, the map is attached here -->
					</div>
					<div id="log" style="border: 1px solid #337428; margin-top: 5px; padding: 3px 5px;">
						<h3>Log window:</h3>
					</div>
				</td>
				<td valign="top">
					<h2>Map Controllers</h2>
					<h4>Custom controllers</h4>
					<button onclick="applyCustomController()">Custom Controller</button>
					<div id="mouse-location" style="padding-left: 40px;"><b>Mouse location: ?</b></div>
					<button onclick="getController()">Get Controller</button>
					
					<h4>Existing controllers</h4>
					Activate a controller on the map:
					<button onclick="applyMapController('PanMode')">Navigation</button>
					<button onclick="applyMapController('MeasureDistanceMode')">Measure distances</button>
					<button onclick="applyMapController('FeatureInfoMode')">Feature Info</button>
					<button onclick="applyMapController('SelectionMode')">Selection</button>
					<button onclick="applyMapController('EditMode')">Editing</button>
				</td>
			</tr>
		</table>
	</div>
</body>

</html>